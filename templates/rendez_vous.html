<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Encodage et titre dynamique selon le conseiller -->
  <meta charset="UTF-8">
  <title>Prendre rendez-vous avec {{ conseiller['prenom'] }} {{ conseiller['nom'] }}</title>

  <!-- Import d’une police stylée pour le titre -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,800&display=swap" rel="stylesheet">

  <!-- Styles internes (design pastel, responsive et fluide) -->
  <style>
    :root {
      --couleur-1: #6F2DBD;
      --couleur-2: #A663CC;
      --couleur-3: #B298DC;
      --couleur-4: #B8D0EB;
      --couleur-5: #B9FAF8;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, var(--couleur-5), var(--couleur-4));
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px 0;
      color: #333;
    }

    h1 {
      font-size: 3em;
      font-weight: 900;
      color: var(--couleur-1);
      margin-bottom: 30px;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .container {
      width: 100%;
      max-width: 1200px;
      background-color: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    h3 {
      color: var(--couleur-1);
      margin: 20px 0 10px;
      font-size: 1.5em;
      border-bottom: 2px solid var(--couleur-1);
      padding-bottom: 5px;
    }

    /* Boutons de créneaux horaires */
    .btn-book {
      background: var(--couleur-1);
      color: #fff;
      padding: 12px 20px;
      margin: 6px;
      border-radius: 12px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: none;
    }

    .btn-book:hover {
      background: var(--couleur-2);
      transform: scale(1.05);
    }

    .btn-book:active {
      transform: scale(0.98);
    }

    /* Pop-up de réservation */
    #reservation-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      background-color: var(--couleur-4);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: fadeIn 0.4s ease-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    #reservation-popup h2 {
      color: var(--couleur-1);
      font-size: 1.8em;
      margin-bottom: 15px;
      text-align: center;
    }

    #reservation-popup textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
      resize: vertical;
      margin-bottom: 15px;
    }

    #reservation-popup button {
      width: 100%;
      padding: 12px;
      font-size: 1.1em;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background-color: var(--couleur-1);
      color: white;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }

    #reservation-popup button:hover {
      background-color: var(--couleur-2);
    }

    /* Champs cachés */
    input[type="hidden"] {
      display: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 2em; }
      .container { padding: 20px; }
      .btn-book { width: 100%; margin: 8px 0; }
      #reservation-popup { width: 90%; }
    }
  </style>
</head>

<body>
  {% include 'header.html' %}

  <!-- Titre dynamique -->
  <h1>Prendre rendez-vous avec {{ conseiller['prenom'] }} {{ conseiller['nom'] }}</h1>

  <!-- Conteneur principal des horaires -->
  <div class="container">
    {% for day, horaires in horaires_disponibles.items() %}
      <h3>{{ day }}</h3>
      <div>
        {% for start_time, end_time in horaires %}
        <div class="btn-book" onclick="openPopup('{{ start_time }}', '{{ end_time }}', '{{ day }}', '{{ conseiller['username'] }}')">
          {{ start_time }} - {{ end_time }}
        </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <!-- Pop-up de confirmation -->
  <div id="reservation-popup">
    <h2>Confirmer la réservation</h2>
    <p>Vous avez choisi le créneau de <span id="start-time"></span> à <span id="end-time"></span> pour {{ conseiller['prenom'] }} {{ conseiller['nom'] }} le <span id="selected-date"></span>.</p>
    <label for="raison">Raison (facultatif) :</label>
    <textarea id="raison" name="raison" rows="4" cols="50"></textarea>
    <button onclick="submitReservation()">Confirmer la réservation</button>
    <button onclick="closePopup()">Annuler</button>
  </div>

  <!-- Champs cachés pour stocker les données -->
  <input type="hidden" id="start_time">
  <input type="hidden" id="end_time">
  <input type="hidden" id="date">
  <input type="hidden" id="conseiller_username">

  <!-- Script JS -->
  <script>
    // Ouvre le pop-up de réservation
    function openPopup(start_time, end_time, date, conseiller_username) {
      document.getElementById('start-time').innerText = start_time;
      document.getElementById('end-time').innerText = end_time;
      document.getElementById('selected-date').innerText = date;
      document.getElementById('start_time').value = start_time;
      document.getElementById('end_time').value = end_time;
      document.getElementById('date').value = date;
      document.getElementById('conseiller_username').value = conseiller_username;
      document.getElementById('reservation-popup').style.display = 'block';
    }

    // Soumet les données de réservation via formulaire POST
    function submitReservation() {
      const raison = document.getElementById('raison').value;
      const start_time = document.getElementById('start_time').value;
      const date = document.getElementById('date').value;
      const conseiller_username = document.getElementById('conseiller_username').value;

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '/reserver/' + conseiller_username + '/' + date + '/' + start_time;

      const raisonInput = document.createElement('input');
      raisonInput.type = 'hidden';
      raisonInput.name = 'raison';
      raisonInput.value = raison;

      form.appendChild(raisonInput);
      document.body.appendChild(form);
      form.submit();
    }

    // Ferme le pop-up
    function closePopup() {
      document.getElementById('reservation-popup').style.display = 'none';
    }
  </script>
</body>
</html>
