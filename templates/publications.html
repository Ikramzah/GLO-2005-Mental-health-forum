<!-- publications.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- M√©tadonn√©es de base -->
  <meta charset="UTF-8">
  <title>Publications</title>

  <!-- Feuille de style principale -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style_homogene.css') }}">
</head>
<body>

  <!-- Barre de navigation -->
  {% include 'header.html' %}

  <!-- Conteneur principal -->
  <div class="publications-container">
    <h1>Liste des publications</h1>

    <!-- Bouton pour cr√©er une nouvelle publication -->
    <div style="text-align: right; margin-bottom: 20px;">
      <a href="{{ url_for('creer_publication') }}">
        <button style="
          padding: 10px 20px;
          background-color: #6f2dbd;
          color: white;
          border: none;
          border-radius: 20px;
          font-weight: bold;
          cursor: pointer;
        ">+ Nouvelle publication</button>
      </a>
    </div>

    <!-- Affichage de toutes les publications -->
    {% for pub in publications %}
    
    <!-- Chaque publication est un lien vers sa page d√©taill√©e -->
    <a href="{{ url_for('afficher_une_publication', id=pub.id_publication) }}" style="text-decoration: none; color: inherit;">
      <div class="publication-card">
        
        <!-- En-t√™te de la publication avec photo de profil et titre -->
        <div style="display: flex; align-items: center;">
          <div class="publication-meta" style="display: flex; align-items: center; gap: 10px;">
            {% if pub.statut == 'anonyme' %}
              <!-- Photo g√©n√©rique si l'auteur est anonyme -->
              <img src="{{ url_for('static', filename='images/photo de profil defaut.png') }}" alt="Anonyme" width="50" height="50" style="border-radius: 50%; object-fit: cover;">
              <h2 class="publication-title">{{ pub.p_titre }}</h2>
            {% else %}
              <!-- Photo r√©elle si l'auteur est public -->
              <img src="{{ url_for('static', filename=pub.photo_de_profil or 'images/photo de profil defaut.png') }}" alt="Photo de profil" width="50" height="50" style="border-radius: 50%; object-fit: cover;">
              <h2 class="publication-title">{{ pub.p_titre }}</h2>
            {% endif %}
          </div>
        </div>

        <!-- M√©tadonn√©es : auteur + date -->
        <div class="publication-meta">
          Post√© par
          {% if pub.statut == 'anonyme' %}
            <em>Utilisateur anonyme</em>
          {% else %}
            <strong>{{ pub.username }}</strong>
          {% endif %}
          le {{ pub['date'].strftime('%d/%m/%Y %H:%M') }}
        </div>

        <!-- Texte de la publication (tronqu√© √† 200 caract√®res) -->
        <div class="publication-text">
          {{ pub.texte|truncate(200) }}
        </div>

        <!-- Pied de la publication : nombre de commentaires + r√©actions -->
        <div class="publication-footer">
          <!-- Nombre de commentaires visibles -->
          <div class="left-comments">
              {{ pub.nb_reponses_visibles }} Commentaire{{ 's' if pub.nb_reponses_visibles > 1 }}
          </div>

          <!-- R√©actions (LIKE, LOVE, etc.) -->
          <div class="right-reactions">
            {% if reactions[pub.id_publication] is defined %}
              {% if reactions[pub.id_publication]['LIKE'] is defined %}
                üëç {{ reactions[pub.id_publication]['LIKE'] }}
              {% endif %}
              {% if reactions[pub.id_publication]['LOVE'] is defined %}
                ‚ù§Ô∏è {{ reactions[pub.id_publication]['LOVE'] }}
              {% endif %}
              {% if reactions[pub.id_publication]['DISLIKE'] is defined %}
                üëé {{ reactions[pub.id_publication]['DISLIKE'] }}
              {% endif %}
              {% if reactions[pub.id_publication]['SAD'] is defined %}
                üò¢ {{ reactions[pub.id_publication]['SAD'] }}
              {% endif %}
              {% if reactions[pub.id_publication]['ANGRY'] is defined %}
                üò° {{ reactions[pub.id_publication]['ANGRY'] }}
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
    </a>

    {% endfor %}
  </div>
</body>
</html>
